<link rel="import" href="../lms-default.html">
<link rel="import" href="../lms-style.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="lms-question-detail-toolbar.html">
<link rel="import" href="lms-question-detail-multiple-choice.html">

<dom-module id="lms-question-detail-view">

  <template strip-whitespace>
    <style include="lms-style">

    </style>

    <app-route route="{{route}}" pattern="/:questionId"
               data="{{routeData}}" tail="{{subroute}}"></app-route>

    <iron-ajax auto name="ajax" url="[[_updateRestUrl(restUrl, routeData)]]"
               method="GET" handle-as="json" content-type="application/json"
               loading="{{loading}}" on-response="_onAjaxResponse"></iron-ajax>

    <lms-question-detail-toolbar user-id="[[userId]]" user-model="[[userModel]]"
                                 route="{{route}}"></lms-question-detail-toolbar>

    <div class="box">
      <template is="dom-if" if="[[_equals(question.type, 'MULTIPLE_CHOICE')]]">
        <lms-question-detail-multiple-choice question="[[question]]">
        </lms-question-detail-multiple-choice>
      </template>

      <template is="dom-if" if="[[_equals(question.type, 'MULTIPLE_RESPONSE')]]">
        <lms-question-detail-multiple-choice question="[[question]]">
        </lms-question-detail-multiple-choice>
      </template>

      <template is="dom-if" if="[[_equals(question.type, 'SHORT_ANSWER')]]">
        <lms-question-detail-multiple-choice question="[[question]]">
        </lms-question-detail-multiple-choice>
      </template>

      <template is="dom-if" if="[[_equals(question.type, 'ESSAY')]]">
        <lms-question-detail-multiple-choice question="[[question]]">
        </lms-question-detail-multiple-choice>
      </template>

      <template is="dom-if" if="[[_equals(question.type, 'COMPOSITE')]]">
        <lms-question-detail-multiple-choice question="[[question]]">
        </lms-question-detail-multiple-choice>
      </template>
    </div>

    <div class="loading-status" hidden$="[[!loading]]">
      <paper-spinner active$="[[loading]]"></paper-spinner>
      [[localize('labelFetchingQuestion')]]
    </div>
  </template>

  <script>
    Polymer({
      is: 'lms-question-detail-view',

      behaviors: [
        Polymer.AppLocalizeBehavior,
        LMS.UtilBehavior,
        LMS.UserBehavior,
        LMS.LocaleBehavior
      ],
      
      properties: {
        restUrl: {
          type: String,
          notify: true
        },
        loading: {
          type: Boolean,
          notify: true
        },
        route: {
          type: Object,
          notify: true
        },
        routeData: {
          type: Object,
          notify: true
        },
        question: {
          type: Object,
          notify: true
        }
      },

      _updateRestUrl: function(restUrl, routeData) {
        if (!!restUrl && !!routeData.questionId) {
          return restUrl + '/' + routeData.questionId;
        }

        return null;
      },

      _onAjaxResponse: function(event) {
        this.question = event.detail.response;
      }
    });
  </script>

</dom-module>