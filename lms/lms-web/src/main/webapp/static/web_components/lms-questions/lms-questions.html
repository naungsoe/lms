<link rel="import" href="../lms-default.html">
<link rel="import" href="../lms-style.html">
<link rel="import" href="../lms-app-nav.html">
<link rel="import" href="../lms-app-search.html">
<link rel="import" href="../lms-app-list.html">
<link rel="import" href="lms-question-list-view.html">
<link rel="import" href="lms-question-detail-view.html">

<dom-module id="lms-questions">

  <template strip-whitespace>
    <style include="lms-style">
      :host {
        @apply(--layout-vertical);
        background-color: var(--paper-grey-50);
        height: 100vh;
        width: 100vw;
      }

      app-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1;
      }

      .main-content {
        max-width: 800px;
        width: 100%;
        margin: 0 auto;
        padding-top: 64px;
      }
    </style>

    <app-location route="{{route}}"></app-location>

    <app-route route="{{route}}" pattern="[[url]]"
               data="{{routeData}}" tail="{{subroute}}"></app-route>

    <app-route route="{{route}}" pattern="[[url]]/:view"
               data="{{routeData}}" tail="{{subroute}}"></app-route>

    <iron-ajax auto url="[[userRestUrl]]" method="GET"
               handle-as="json" content-type="application/json"
               loading="{{loading}}" on-response="_onAjaxResponse"></iron-ajax>

    <app-header nav condenses fixed effects="waterfall">
      <app-toolbar>
        <paper-icon-button icon="menu" on-tap="_onMenuTap"></paper-icon-button>
        <h3 main-title>[[localize('titlePage')]]</h3>
        <lms-app-search query-term="{{queryTerm}}" hidden$="[[_hasRoute(routeData)]]"
                        language="[[language]]" resources="[[resources]]"></lms-app-search>
      </app-toolbar>
    </app-header>

    <div class="main-content">
      <lms-question-list-view route="{{route}}" userId="[[userId]]" url="[[url]]"
                              filters-url="[[filtersUrl]]" rest-url="[[restUrl]]"
                              query-term="[[queryTerm]]" hidden$="[[_hasRoute(routeData)]]"
                              language="[[language]]" resources="[[resources]]">
      </lms-question-list-view>

      <iron-pages selected="[[routeData.view]]" attr-for-selected="name">
        <lms-question-detail-view name="detail" route="{{subroute}}" user-id="[[userId]]"
                                  user-model="[[userModel]]" rest-url="[[restUrl]]"
                                  language="[[language]]" resources="[[resources]]">
        </lms-question-detail-view>
      </iron-pages>
    </div>

    <app-drawer swipe-open>
      <lms-app-nav language="[[language]]" resources="[[resources]]"></lms-app-nav>
    </app-drawer>
  </template>

  <script>
    Polymer({
      is: 'lms-questions',

      behaviors: [
        Polymer.AppLocalizeBehavior,
        LMS.UserBehavior,
        LMS.LocaleBehavior
      ],

      properties: {
        title: {
          type: String,
          notify: true
        },
        filtersUrl: {
          type: String,
          notify: true
        },
        restUrl: {
          type: String,
          notify: true
        },
        url: {
          type: String,
          notify: true
        },
        route: {
          type: Object,
          notify: true
        },
        routeData: {
          type: Object,
          notify: true
        },
        subroute: {
          type: Object,
          notify: true
        },
        queryTerm: {
          type: String,
          notify: true
        },
        loading: {
          type: Boolean,
          notify: true
        }
      },

      _hasRoute: function(routeData) {
        return !!routeData.view && (routeData.view !== '');
      },

      _onAjaxResponse: function(event) {
        var response = event.detail.response;
      },

      _onMenuTap: function(event) {
        this.$$('app-drawer').toggle();
      }
    });
  </script>

</dom-module>