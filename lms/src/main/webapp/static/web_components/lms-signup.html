<link rel="import" href="lms-default.html">
<link rel="import" href="lms-style.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/app-localize-behavior/app-localize-behavior.html">

<dom-module id="lms-signin">

  <template strip-whitespace>
    <style include="lms-style">
      :host {
        height: 100vh;
        width: 100vw;
        @apply(--layout-vertical);
        @apply(--layout-center);
        @apply(--layout-center-justified);
      }

      paper-card {
        width: 320px;
      }

      paper-card .card-actions {
        border: 0 !important;
        margin: 0 0 16px 0;
      }

      paper-input {
        margin: 0 0 8px 0;
      }

      .module-actions {
        padding: 16px 0;
      }
    </style>

    <form id="formLogin" method="post" action="{{signinUrl}}">
      <paper-card heading="{{localize('titleCard')}}" alt="{{localize('titleCard')}}">
        <div class="card-content">
          <paper-input name="id" label="{{localize('labelId')}}" on-keydown="handleKeydown" autofocus no-label-float required error-message="{{localize('labelIdRequired')}}"></paper-input>
          <paper-input name="password" label="{{localize('labelPassword')}}" on-keydown="handleKeydown" no-label-float required error-message="{{localize('labelPasswordRequired')}}"></paper-input>
        </div>
        <div class="card-actions">
          <paper-button on-tap="handleSignIn" raised>{{localize('buttonSignIn')}}</paper-button>
          <paper-button class="link">{{localize('buttonForgotPassword')}}</paper-button>
        </div>
      </paper-card>

    </form>
    <div class="module-actions">
      <paper-button on-tap="handleSignUp" class="link">{{localize('buttonSignUp')}}</paper-button>
    </div>
  </template>

  <script>
    Polymer({
      is: 'lms-signin',

      behaviors: [
        Polymer.AppLocalizeBehavior
      ],
      
      properties: {
        signInUrl: {
          type: String,
          notify: true
        },
        signUpUrl: {
          type: String,
          notify: true
        },
        language: {
          type: String,
          notify: true
        },
        localeUrl: {
          type: String,
          notify: true
        }
      },

      attached: function() {
        var url = this.resolveUrl(this.localeUrl);
        this.loadResources(url);
      },

      handleKeydown: function(event) {
        if (event.keyCode === 13) {
          this.handleSubmit();
        }
      },

      handleSignIn: function(event) {
        var valid = this.$$('[name=id]').validate();
        valid = this.$$('[name=password]').validate() && valid;

        if (valid) {
          this.$.formLogin.submit();
        }
      },

      handleSignUp: function(event) {
        window.location = this.signUpUrl;
      }
    });
  </script>
  
</dom-module>